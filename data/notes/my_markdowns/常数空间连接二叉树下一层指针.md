# å¸¸æ•°ç©ºé—´è¿æ¥äºŒå‰æ ‘ä¸‹ä¸€å±‚æŒ‡é’ˆ

## ğŸ§‘â€ğŸ’» User

å¦‚ä½•ä½¿ç”¨å¸¸æ•°çº§é¢å¤–ç©ºé—´è§£å†³åŠ›æ‰£117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II

---
## ğŸ¤– Assistant

**æ ¸å¿ƒæ€è·¯ï¼šç”¨å·²å»ºç«‹çš„ `next` æŒ‡é’ˆåšâ€œå½“å‰å±‚é“¾è¡¨â€ï¼Œå†ç”¨ä¸€ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹æ‹¼å‡ºâ€œä¸‹ä¸€å±‚é“¾è¡¨â€ï¼Œæ•´ä¸ªè¿‡ç¨‹åªç”¨å¸¸æ•°ä¸ªæŒ‡é’ˆå˜é‡ã€‚**

---

## ä¸€ã€ä¸ºä»€ä¹ˆæ™®é€š BFS ä¸è¡Œï¼Ÿ

æœ€ç›´è§‚çš„åšæ³•ï¼šç”¨é˜Ÿåˆ—æŒ‰å±‚ BFSï¼Œæ¯å‡ºé˜Ÿä¸€ä¸ªèŠ‚ç‚¹å°±æŠŠå®ƒçš„å­©å­è¿æ¥èµ·æ¥ã€‚
é—®é¢˜ï¼šé˜Ÿåˆ—éœ€è¦ O(n) é¢å¤–ç©ºé—´ï¼Œä¸æ»¡è¶³â€œå¸¸æ•°çº§é¢å¤–ç©ºé—´â€ã€‚

é¢˜ç›®è¦æ±‚çš„â€œå¸¸æ•°ç©ºé—´â€ï¼Œä¸€èˆ¬æŒ‡ï¼š
- åªèƒ½ç”¨å°‘é‡æŒ‡é’ˆå˜é‡ï¼ˆå‡ ä¸ªæŒ‡é’ˆã€dummy èŠ‚ç‚¹éƒ½å¯ä»¥ï¼‰
- ä¸å…è®¸ç”¨æŒ‰èŠ‚ç‚¹æ•°/å±‚æ•°çº¿æ€§å¢é•¿çš„æ•°ç»„ã€é˜Ÿåˆ—ã€æ ˆ

---

## äºŒã€æ ¸å¿ƒæŠ€å·§ï¼šä¸‰æŒ‡é’ˆ + è™šæ‹Ÿå¤´ç»“ç‚¹

### æ•´ä½“ç»“æ„

1. **å¤–å±‚ while**ï¼šä¸€å±‚ä¸€å±‚å¤„ç†
 - `cur` æŒ‡å‘å½“å‰å±‚æœ€å·¦ä¾§èŠ‚ç‚¹ï¼ˆåˆå§‹ä¸ºæ ¹èŠ‚ç‚¹ `root`ï¼‰

2. **å†…å±‚ while**ï¼šæ²¿ç€å½“å‰å±‚çš„ `next` æŒ‡é’ˆæ¨ªå‘æ‰«è¿‡å»
 - å¯¹å½“å‰å±‚çš„æ¯ä¸ªèŠ‚ç‚¹ `cur`ï¼š
 - çœ‹å®ƒçš„ `left` / `right` å­©å­
 - æŠŠæœ‰çš„å­©å­æŒ‰ä»å·¦åˆ°å³ç”¨ `next` ä¸²èµ·æ¥ï¼Œæ„æˆâ€œä¸‹ä¸€å±‚é“¾è¡¨â€

3. **å…³é”®ï¼šå¦‚ä½•æ‹¼å‡ºä¸‹ä¸€å±‚çš„é“¾è¡¨ï¼Ÿ**
 - ç”¨ä¸€ä¸ª**è™šæ‹Ÿå¤´ç»“ç‚¹ `dummy`** + **å°¾æŒ‡é’ˆ `tail`**
 - åˆå§‹åŒ–ï¼š`dummy = Node(0)`ï¼Œ`tail = dummy`
 - éå†å½“å‰å±‚æ—¶ï¼š
 - å¦‚æœæœ‰ `left`ï¼š
 `tail.next = cur.left`ï¼Œ`tail = tail.next`
 - å¦‚æœæœ‰ `right`ï¼š
 `tail.next = cur.right`ï¼Œ`tail = tail.next`
 - ä¸€å±‚ç»“æŸåï¼š
 `cur = dummy.next`ï¼Œå³ä¸‹ä¸€å±‚æœ€å·¦ä¾§èŠ‚ç‚¹
 - ç„¶åé‡æ–°å¼€å§‹ä¸‹ä¸€è½®å¤–å±‚ while

4. **ä¿è¯ç©ºé—´æ˜¯ O(1)**ï¼š
 - æ•´ä¸ªè¿‡ç¨‹ä¸­åªæœ‰å›ºå®šçš„æŒ‡é’ˆå˜é‡ï¼š`cur`ã€`dummy`ã€`tail`
 - æ²¡æœ‰ç”¨é˜Ÿåˆ—æˆ–æ•°ç»„å­˜èŠ‚ç‚¹

---

## ä¸‰ã€ä»£ç å®ç°ï¼ˆPythonï¼Œå¸¸æ•°çº§é¢å¤–ç©ºé—´ï¼‰

åŠ›æ‰£ 117 çš„ `Node` å®šä¹‰å¤§è‡´å¦‚ä¸‹ï¼š

```python
# Definition for a Node.
class Node:
    def __init__(self, val: int = 0,
                 left: 'Node' = None,
                 right: 'Node' = None,
                 next: 'Node' = None):
        self.val = val
        self.left = left
        self.right = right
        self.next = next
```

è§£æ³•ä»£ç ï¼š

```python
from typing import Optional


class Solution:
    def connect(self, root: Optional['Node']) -> Optional['Node']:
        """å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆï¼Œä½¿ç”¨O(1)é¢å¤–ç©ºé—´ã€‚

        æ€è·¯ï¼š
        - ä½¿ç”¨å·²å»ºç«‹å¥½çš„ next æŒ‡é’ˆï¼ŒæŠŠæ¯ä¸€å±‚è§†ä¸ºä¸€æ¡é“¾è¡¨ã€‚
        - å¤–å±‚å¾ªç¯ï¼šé€å±‚å¤„ç†ï¼Œcur æŒ‡å‘å½“å‰å±‚æœ€å·¦ä¾§èŠ‚ç‚¹ã€‚
        - å†…å±‚å¾ªç¯ï¼šæ²¿ç€å½“å‰å±‚çš„ next æŒ‡é’ˆæ¨ªå‘éå†ã€‚
          åŒæ—¶ç”¨ dummy + tail ä¸¤ä¸ªæŒ‡é’ˆï¼ŒæŠŠä¸‹ä¸€å±‚èŠ‚ç‚¹è¿æˆä¸€æ¡é“¾è¡¨ï¼š
          - å¯¹äºå½“å‰èŠ‚ç‚¹ curï¼š
            - å¦‚æœæœ‰ leftï¼Œtail.next = cur.leftï¼Œtail åç§»ã€‚
            - å¦‚æœæœ‰ rightï¼Œtail.next = cur.rightï¼Œtail åç§»ã€‚
        - ä¸€å±‚å¤„ç†å®Œåï¼Œdummy.next å°±æ˜¯ä¸‹ä¸€å±‚çš„æœ€å·¦èŠ‚ç‚¹ï¼Œ
          ä»¤ cur = dummy.nextï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€å±‚ã€‚
        - å…¨ç¨‹åªç”¨æœ‰é™å‡ ä¸ªæŒ‡é’ˆå˜é‡ï¼Œé¢å¤–ç©ºé—´ä¸º O(1)ã€‚
        """
        if not root:
            return root

        # cur æŒ‡å‘å½“å‰å±‚æœ€å·¦ä¾§çš„èŠ‚ç‚¹
        cur = root

        while cur:
            # dummy æ˜¯ä¸‹ä¸€å±‚é“¾è¡¨çš„è™šæ‹Ÿå¤´ç»“ç‚¹ï¼Œtail æ˜¯å…¶å°¾æŒ‡é’ˆ
            dummy = Node(0)
            tail = dummy

            # éå†å½“å‰å±‚ï¼šåˆ©ç”¨å·²ç»å»ºç«‹å¥½çš„ next æŒ‡é’ˆæ¨ªå‘ç§»åŠ¨
            while cur:
                if cur.left:
                    # è¿æ¥å·¦å­©å­åˆ°ä¸‹ä¸€å±‚é“¾è¡¨
                    tail.next = cur.left
                    tail = tail.next
                if cur.right:
                    # è¿æ¥å³å­©å­åˆ°ä¸‹ä¸€å±‚é“¾è¡¨
                    tail.next = cur.right
                    tail = tail.next

                # ç§»åŠ¨åˆ°å½“å‰å±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
                cur = cur.next

            # è¿›å…¥ä¸‹ä¸€å±‚ï¼šdummy.next æ˜¯ä¸‹ä¸€å±‚æœ€å·¦ä¾§èŠ‚ç‚¹
            cur = dummy.next

        return root
```

---

## å››ã€å’Œ 116 é¢˜çš„åŒºåˆ«ï¼ˆé¢è¯•å¯èƒ½ä¼šé—®ï¼‰

- **116 æ˜¯å®Œç¾äºŒå‰æ ‘**ï¼šæ¯ä¸ªéå¶å­èŠ‚ç‚¹ä¸€å®šæœ‰ä¸¤ä¸ªå­©å­ã€ä¸”æ‰€æœ‰å¶å­éƒ½åœ¨åŒä¸€å±‚
 - å¯ä»¥ç›´æ¥ï¼š
 - `root.left.next = root.right`
 - `root.right.next = root.next.left`ï¼ˆè‹¥å­˜åœ¨ï¼‰
 - åªéœ€è¦ä»ä¸Šåˆ°ä¸‹ï¼Œç”¨å·²æœ‰çš„ `next` å°±èƒ½è¿èµ·æ¥

- **117 æ˜¯æ™®é€šäºŒå‰æ ‘ï¼ˆä¸å®Œç¾ï¼‰**ï¼š
 - æŸä¸ªèŠ‚ç‚¹å¯èƒ½åªæœ‰å·¦å­©å­æˆ–å³å­©å­
 - ä¸èƒ½ç®€å•ç”¨â€œå…„å¼ŸèŠ‚ç‚¹çš„å·¦å­©å­â€è¿™ç§å¥—è·¯
 - æ‰€ä»¥è¦ç”¨â€œdummy + tail ä¸²ä¸‹ä¸€å±‚â€çš„é€šç”¨æ–¹æ³•

---

## äº”ã€é¢è¯•ä¸­ 30 ç§’å£è¿°æ€è·¯æ¨¡æ¿

ä½ å¯ä»¥ç›´æ¥èƒŒä¸‹é¢è¿™æ®µè¯ï¼Œåœ¨ 30 ç§’å†…è®²å®Œï¼š

> è¿™é¢˜è¦ O(1) é¢å¤–ç©ºé—´ï¼Œä¸èƒ½ç”¨é˜Ÿåˆ— BFSã€‚
> æˆ‘æŠŠæ¯ä¸€å±‚å½“æˆä¸€æ¡ç”± next æŒ‡é’ˆä¸²èµ·æ¥çš„é“¾è¡¨æ¥å¤„ç†ã€‚
> å¤–å±‚ while ç”¨ä¸€ä¸ªæŒ‡é’ˆ cur æŒ‡å‘å½“å‰å±‚æœ€å·¦èŠ‚ç‚¹ï¼›å†…å±‚ while æ²¿ç€ cur çš„ next æ¨ªå‘éå†å½“å‰å±‚ã€‚
> åŒæ—¶æˆ‘ç”¨ä¸€ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹ dummy å’Œä¸€ä¸ªå°¾æŒ‡é’ˆ tailï¼ŒæŠŠå½“å‰å±‚æ‰€æœ‰èŠ‚ç‚¹çš„å­©å­æŒ‰ä»å·¦åˆ°å³ä¸²æˆä¸‹ä¸€å±‚é“¾è¡¨ï¼šé‡åˆ° left/right å°± tail.next = childï¼Œtail åç§»ã€‚
> ä¸€å±‚å¤„ç†å®Œåï¼Œdummy.next å°±æ˜¯ä¸‹ä¸€å±‚æœ€å·¦èŠ‚ç‚¹ï¼Œå†èµ‹ç»™ cur ç»§ç»­ã€‚
> å…¨ç¨‹åªç”¨å‡ ä¸ªæŒ‡é’ˆå˜é‡ï¼Œæ²¡æœ‰é˜Ÿåˆ—ï¼Œæ‰€ä»¥æ˜¯ O(1) ç©ºé—´ï¼Œæ—¶é—´ O(n)ã€‚

---
## ğŸ§‘â€ğŸ’» User

å¦‚ä½•ç”¨ä¸€å¥è¯æ€»ç»“è¿™é“é¢˜ O(1) è§£æ³•çš„å·§å¦™ä¹‹å¤„

---
## ğŸ¤– Assistant

åˆ©ç”¨å½“å‰å±‚å·²ç»å»ºç«‹å¥½çš„ `next` æŒ‡é’ˆæŠŠè¿™ä¸€å±‚å½“ä½œé“¾è¡¨æ¨ªå‘éå†ï¼ŒåŒæ—¶ç”¨ä¸€ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹å’Œå°¾æŒ‡é’ˆåœ¨éå†è¿‡ç¨‹ä¸­æŒ‰é¡ºåºæ‹¼æ¥å‡ºä¸‹ä¸€å±‚çš„é“¾è¡¨ï¼Œå› æ­¤æ— éœ€é˜Ÿåˆ—ç­‰é¢å¤–æ•°æ®ç»“æ„å°±å®ç°äº†å±‚åºè¿æ¥ã€ç©ºé—´ O(1)ã€‚

---
## ğŸ§‘â€ğŸ’» User

ç»§ç»­ç»™å‡º116. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆçš„ O(1) è§£æ³•

---
## ğŸ¤– Assistant

æ€è·¯åˆ©ç”¨çš„æ˜¯ã€Œå®Œç¾äºŒå‰æ ‘ã€è¿™ä¸ªå¼ºå‡è®¾ï¼šæ¯ä¸ªéå¶å­èŠ‚ç‚¹ä¸€å®šæœ‰ä¸¤ä¸ªå­©å­ã€ä¸‹ä¸€å±‚æ˜¯è¿ç»­æ’æ»¡çš„ï¼Œæ‰€ä»¥å¯ä»¥çº¯é çˆ¶èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼ŒæŠŠæ•´æ£µæ ‘è¿èµ·æ¥ï¼Œå®Œå…¨ä¸éœ€è¦é˜Ÿåˆ—ã€‚

---

## ä¸€ã€æ ¸å¿ƒæ€è·¯ï¼ˆä¸ºä»€ä¹ˆèƒ½ O(1)ï¼‰

1. ç”¨ä¸€ä¸ªæŒ‡é’ˆ `leftmost` æŒ‡å‘ã€Œå½“å‰å±‚æœ€å·¦ä¾§èŠ‚ç‚¹ã€ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚
2. å¯¹äºè¿™ä¸€å±‚ï¼Œä»å·¦åˆ°å³éå†æ¯ä¸ªèŠ‚ç‚¹ `head`ï¼Œåšä¸¤ä»¶äº‹ï¼š
 - æŠŠåŒä¸€ä¸ªçˆ¶äº²çš„ä¸¤ä¸ªå­©å­è¿èµ·æ¥ï¼š
 `head.left.next = head.right`
 - æŠŠä¸åŒçˆ¶äº²ä½†ç›¸é‚»çš„ä¸¤ä¸ªå­©å­è¿èµ·æ¥ï¼š
 å¦‚æœ `head.next` å­˜åœ¨ï¼ˆå³è¾¹è¿˜æœ‰ä¸€ä¸ªçˆ¶äº²ï¼‰ï¼Œ
 é‚£ä¹ˆ `head.right.next = head.next.left`
3. å½“å‰å±‚å¤„ç†å®Œåï¼Œæ•´å±‚çš„ä¸‹ä¸€å±‚éƒ½å·²ç»ç”¨ `next` ä¸²å®Œäº†ï¼Œ
å†æŠŠ `leftmost` ç§»åˆ°ä¸‹ä¸€å±‚æœ€å·¦èŠ‚ç‚¹ï¼š`leftmost = leftmost.left`ï¼Œç»§ç»­å¤„ç†ã€‚
4. æ•´ä¸ªè¿‡ç¨‹åªç”¨å‡ ä¸ªæŒ‡é’ˆï¼š`leftmost`ã€`head`ï¼Œæ²¡æœ‰é˜Ÿåˆ—ï¼Œç©ºé—´ O(1)ã€‚

ä¹‹æ‰€ä»¥èƒ½è¿™æ ·åšï¼Œæ˜¯å› ä¸º**å®Œç¾äºŒå‰æ ‘ä¿è¯**ï¼š
- æ¯ä¸ªéå¶å­èŠ‚ç‚¹éƒ½æœ‰ `left` å’Œ `right`
- åŒä¸€å±‚çš„ç›¸é‚»ä¸¤ä¸ªçˆ¶äº² `head`ã€`head.next` çš„å­©å­ï¼Œä¸€å®šæ˜¯ `head.right` å’Œ `head.next.left`

---

## äºŒã€Python å®ç°ï¼ˆO(1) é¢å¤–ç©ºé—´ï¼‰

åŠ›æ‰£ä¸Šçš„ `Node` å®šä¹‰ï¼ˆä¾›å‚è€ƒï¼‰ï¼š

```python
# Definition for a Node.
class Node:
    def __init__(self, val: int = 0,
                 left: 'Node' = None,
                 right: 'Node' = None,
                 next: 'Node' = None):
        self.val = val
        self.left = left
        self.right = right
        self.next = next
```

è§£æ³•ä»£ç ï¼š

```python
from typing import Optional


class Solution:
    def connect(self, root: Optional['Node']) -> Optional['Node']:
        """å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆï¼Œä½¿ç”¨O(1)é¢å¤–ç©ºé—´ã€‚

        æ€è·¯ï¼š
        - è¿™æ˜¯å®Œç¾äºŒå‰æ ‘ï¼šæ¯ä¸ªéå¶å­èŠ‚ç‚¹ä¸€å®šæœ‰å·¦å³ä¸¤ä¸ªå­©å­ï¼Œä¸‹ä¸€å±‚æ˜¯æ’æ»¡çš„ã€‚
        - ç”¨ leftmost æŒ‡å‘å½“å‰å±‚æœ€å·¦èŠ‚ç‚¹ï¼›ä»æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚
        - å¯¹äºå½“å‰å±‚ï¼Œç”¨ head æŒ‡é’ˆæ²¿ç€ next æŒ‡é’ˆæ¨ªå‘éå†ï¼š
          1ï¼‰æŠŠ head.left.next è¿æ¥åˆ° head.rightï¼›
          2ï¼‰å¦‚æœ head.next å­˜åœ¨ï¼Œåˆ™æŠŠ head.right.next è¿æ¥åˆ° head.next.leftã€‚
        - å½“å‰å±‚å¤„ç†å®Œåï¼Œä¸‹ä¸€å±‚çš„ next æŒ‡é’ˆå°±å…¨éƒ¨å»ºç«‹å¥½ï¼Œ
          ç„¶åä»¤ leftmost = leftmost.leftï¼Œå‘ä¸‹è¿›å…¥ä¸‹ä¸€å±‚ã€‚
        - åªä½¿ç”¨å¸¸æ•°ä¸ªæŒ‡é’ˆå˜é‡ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ—¶é—´å¤æ‚åº¦ O(n)ã€‚
        """
        if not root:
            return root

        # æŒ‡å‘å½“å‰å±‚æœ€å·¦ä¾§èŠ‚ç‚¹
        leftmost = root

        # åªè¦å½“å‰å±‚è¿˜æœ‰å­èŠ‚ç‚¹ï¼Œå°±ç»§ç»­å‘ä¸‹
        # ç”±äºæ˜¯å®Œç¾äºŒå‰æ ‘ï¼Œåªéœ€è¦åˆ¤æ–­ leftmost.left æ˜¯å¦å­˜åœ¨
        while leftmost.left:
            head = leftmost

            # æ²¿ç€å½“å‰å±‚çš„ next æŒ‡é’ˆæ¨ªå‘éå†
            while head:
                # 1. è¿æ¥åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å·¦å³å­©å­
                head.left.next = head.right

                # 2. è¿æ¥è·¨çˆ¶èŠ‚ç‚¹çš„å­©å­ï¼šå³å­©å­ -> å³è¾¹çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­
                if head.next:
                    head.right.next = head.next.left

                # å½“å‰å±‚å‘å³ç§»åŠ¨
                head = head.next

            # è¿›å…¥ä¸‹ä¸€å±‚ï¼šä¸‹ä¸€å±‚æœ€å·¦ä¾§èŠ‚ç‚¹å°±æ˜¯å½“å‰å±‚æœ€å·¦èŠ‚ç‚¹çš„ left
            leftmost = leftmost.left

        return root
```

---

## ä¸‰ã€å’Œ 117 é¢˜çš„åŒºåˆ«ï¼ˆé¢è¯•å¾ˆçˆ±é—®ï¼‰

- **116ï¼ˆå®Œç¾äºŒå‰æ ‘ï¼‰**ï¼š
åˆ©ç”¨ç»“æ„è§„åˆ™ï¼Œæ¨ªå‘è¿æ¥æ—¶å¯ä»¥ç›´æ¥ç”¨ `head.next.left`ï¼Œä¸éœ€è¦æ‰«ææ•´å±‚å»æ‰¾ä¸‹ä¸€ä¸ªå­©å­ï¼Œé€»è¾‘ç®€å•ã€åªä¾èµ–å±€éƒ¨ä¿¡æ¯ã€‚
- **117ï¼ˆä¸€èˆ¬äºŒå‰æ ‘ï¼‰**ï¼š
ä¸èƒ½ä¿è¯æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­©å­ï¼Œåªèƒ½ç”¨â€œdummy + tail ä¸²ä¸‹ä¸€å±‚â€çš„é€šç”¨å†™æ³•ã€‚

ä¸€å¥å¯¹æ¯”æ€»ç»“ï¼š
116 é¢˜é â€œå®Œç¾äºŒå‰æ ‘çš„ç»“æ„è§„å¾‹â€å±€éƒ¨æ¨å¯¼å‡º next å…³ç³»ï¼›
117 é¢˜å› ä¸ºç»“æ„ä¸è§„åˆ™ï¼Œåªèƒ½å¤šå¼•å…¥ä¸€ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹ï¼Œåœ¨éå†å½“å‰å±‚æ—¶é¡ºæ‰‹æŠŠä¸‹ä¸€å±‚ä¸²èµ·æ¥ã€‚

---

## å››ã€é¢è¯•ä¸­ 30 ç§’å£è¿°æ€è·¯æ¨¡æ¿

ä½ å¯ä»¥èƒŒä¸‹é¢è¿™æ®µè¯è¯´ç»™é¢è¯•å®˜å¬ï¼š

> è¿™é¢˜æ˜¯å®Œç¾äºŒå‰æ ‘ï¼Œæ‰€ä»¥æ¯ä¸ªéå¶å­èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­©å­ï¼Œä¸‹ä¸€å±‚æ˜¯è¿ç»­æ’æ»¡çš„ã€‚
> æˆ‘ç”¨ä¸€ä¸ªæŒ‡é’ˆ leftmost æŒ‡å‘å½“å‰å±‚æœ€å·¦çš„èŠ‚ç‚¹ï¼›åœ¨è¿™ä¸€å±‚é‡Œï¼Œç”¨ head æ²¿ç€ next æŒ‡é’ˆæ¨ªå‘éå†ã€‚
> å¯¹æ¯ä¸ª headï¼Œå…ˆè¿åŒä¸€çˆ¶äº²çš„ä¸¤ä¸ªå­©å­ï¼šhead.left.next = head.rightï¼›
> å¦‚æœ head.next å­˜åœ¨ï¼Œå†è¿è·¨çˆ¶èŠ‚ç‚¹çš„å­©å­ï¼šhead.right.next = head.next.leftã€‚
> å½“å‰å±‚å¤„ç†å®Œåï¼Œä¸‹ä¸€å±‚çš„ next éƒ½å·²ç»å»ºå¥½ï¼Œç„¶åæŠŠ leftmost ç§»åˆ° leftmost.left ç»§ç»­ã€‚
> è¿™æ ·åªç”¨å‡ ä¸ªæŒ‡é’ˆï¼Œä¸ç”¨é˜Ÿåˆ—ï¼Œç©ºé—´ O(1)ï¼Œæ—¶é—´ O(n)ã€‚

---
## ğŸ§‘â€ğŸ’» User

117 é¢˜çš„ä»£ç è§£æ³•æ˜¯ï¼š
class Solution:
 def connect(self, root: 'Node') -> 'Node':
 if not root:
 return None
 curr = root
 while curr:
 dummy = Node()
 tail = dummy
 while curr:
 if curr.left:
 tail.next = curr.left
 tail = tail.next
 if curr.right:
 tail.next = curr.right
 tail = tail.next
 curr = curr.next
 curr = dummy.next
 return root

116 é¢˜çš„ä»£ç è§£æ³•æ˜¯ï¼š
class Solution:
 def connect(self, root: 'Optional[Node]') -> 'Optional[Node]':
 if not root:
 return None
 left_most = root
 while left_most.left:
 head = left_most
 while head:
 head.left.next = head.right
 if head.next:
 head.right.next = head.next.left
 head = head.next
 left_most = left_most.left
 return root

ä¸¤é“é¢˜çš„ç¬¬ä¸€å±‚ while å¾ªç¯çš„åˆ¤å®šæ¡ä»¶åˆ†åˆ«æ˜¯ while curr å’Œ while left_most.leftï¼Œè¿™ä¸¤ç§å†™æ³•èƒ½ç»Ÿä¸€æˆä¸€ç§å†™æ³•æ¨¡å¼å—ï¼Ÿæ¯”å¦‚éƒ½å¸¦ left æˆ–è€…éƒ½ä¸å¸¦ leftï¼Œä»¥æ–¹ä¾¿è®°å¿†æˆä¸€ä¸ªç»Ÿä¸€çš„æ€ç»´æ¨¡æ¿

---
## ğŸ¤– Assistant

å¯ä»¥ç»Ÿä¸€ï¼Œ**ç»Ÿä¸€æˆã€Œåªåˆ¤æ–­å½“å‰å±‚æœ‰æ²¡æœ‰å¤´ç»“ç‚¹ã€çš„å†™æ³•ï¼š`while level_head:`**ï¼Œè€Œä¸æ˜¯ `while level_head.left`ã€‚

`while left_most.left` åªæ˜¯åˆ©ç”¨äº†â€œå®Œç¾äºŒå‰æ ‘â€è¿™ä¸ªå¼ºå‡è®¾åšçš„ä¸€ä¸ªå°ä¼˜åŒ–ï¼Œæœ¬è´¨æ¨¡æ¿å…¶å®è·Ÿ 117 é¢˜æ˜¯ä¸€æ ·çš„ï¼š
> æœ‰å½“å‰å±‚çš„å¤´ç»“ç‚¹ï¼Œå°±å¤„ç†è¿™ä¸€å±‚ï¼›åœ¨å¤„ç†è¿‡ç¨‹ä¸­é¡ºä¾¿ç®—å‡ºä¸‹ä¸€å±‚çš„å¤´ç»“ç‚¹ï¼Œäº¤ç»™ä¸‹ä¸€è½® whileã€‚

---

## ä¸€ã€ä¸ºä»€ä¹ˆç»Ÿä¸€æˆ `while level_head` æ›´åˆç†ï¼Ÿ

- 117 é¢˜æ˜¯**æ™®é€šäºŒå‰æ ‘**ï¼šæœ‰çš„èŠ‚ç‚¹åªæœ‰å³å­©å­ã€æœ‰çš„åªæœ‰å·¦å­©å­ï¼Œ
ä½ æ ¹æœ¬ä¸èƒ½ç”¨ã€ŒæŸä¸ªèŠ‚ç‚¹çš„ `left` æ˜¯å¦å­˜åœ¨ã€æ¥åˆ¤æ–­â€œä¸‹ä¸€å±‚æ˜¯å¦å­˜åœ¨â€ã€‚
- 116 é¢˜æ˜¯**å®Œç¾äºŒå‰æ ‘**ï¼š
 - å½“å‰å±‚åªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä¸€å®šæœ‰ `left` å’Œ `right`ï¼Œ
 - æ‰€ä»¥å†™æˆ `while left_most.left:` ä¹Ÿæˆç«‹ï¼Œä½†è¿™æ˜¯ä¸€ç§â€œåˆ©ç”¨ç‰¹æ®Šæ€§è´¨â€çš„å†™æ³•ã€‚

ä¸ºäº†è®°å¿†æˆä¸€ä¸ªç»Ÿä¸€æ¨¡æ¿ï¼Œ**å»ºè®®éƒ½è®°æˆï¼š**

```python
level_head = root
while level_head:
    # éå†å½“å‰å±‚ï¼Œé¡ºä¾¿æŠŠä¸‹ä¸€å±‚ä¸²æˆé“¾è¡¨
    # next_level_head = ... ï¼ˆå› é¢˜ç›®ç»“æ„ä¸åŒè€Œä¸åŒï¼‰
    level_head = next_level_head
```

åŒºåˆ«åªåœ¨ã€Œ`next_level_head` æ€ä¹ˆæ±‚ã€ã€‚

---

## äºŒã€æŠŠ 116 é¢˜æ”¹å†™æˆç»Ÿä¸€æ¨¡æ¿ï¼ˆå’Œ 117 ä¸€è‡´é£æ ¼ï¼‰

### 117 é¢˜ï¼ˆæ™®é€šäºŒå‰æ ‘ï¼‰å½“å‰å†™æ³•å…¶å®å·²ç»æ˜¯è¿™ä¸ªæ¨¡æ¿

```python
class Solution:
    def connect(self, root: 'Node') -> 'Node':
        if not root:
            return None
        curr = root
        while curr:  # == while å½“å‰å±‚æœ‰å¤´ç»“ç‚¹
            dummy = Node()
            tail = dummy
            while curr:
                if curr.left:
                    tail.next = curr.left
                    tail = tail.next
                if curr.right:
                    tail.next = curr.right
                    tail = tail.next
                curr = curr.next
            curr = dummy.next  # ä¸‹ä¸€å±‚çš„å¤´ç»“ç‚¹
        return root
```

è¿™é‡Œ `curr` å°±æ˜¯â€œå½“å‰å±‚çš„å¤´ç»“ç‚¹â€ã€‚

---

### 116 é¢˜ï¼šæ”¹å†™æˆåŒä¸€æ¨¡å¼

æŠŠåŸæ¥çš„ `while left_most.left` æ”¹æˆ `while left_most`ï¼Œå¹¶åœ¨å¾ªç¯å¼€å¤´åˆ¤æ–­â€œå¦‚æœå·²ç»æ˜¯å¶å­å±‚ï¼Œå°±é€€å‡ºâ€ï¼š

```python
class Solution:
    def connect(self, root: 'Optional[Node]') -> 'Optional[Node]':
        if not root:
            return None

        # å½“å‰å±‚çš„æœ€å·¦èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰å±‚çš„å¤´ç»“ç‚¹ï¼‰
        left_most = root

        # ç»Ÿä¸€æ¨¡æ¿ï¼šwhile å½“å‰å±‚æœ‰å¤´ç»“ç‚¹
        while left_most:
            head = left_most

            # å¦‚æœå½“å‰å±‚å·²ç»æ˜¯å¶å­å±‚ï¼ˆæ²¡æœ‰å­©å­ï¼‰ï¼Œå°±ä¸éœ€è¦å†å¾€ä¸‹è¿äº†
            if not head.left:
                break

            # éå†å½“å‰å±‚ï¼Œåˆ©ç”¨ next æ¨ªå‘ç§»åŠ¨
            while head:
                # 1. è¿æ¥åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å·¦å³å­©å­
                head.left.next = head.right

                # 2. è¿æ¥è·¨çˆ¶èŠ‚ç‚¹çš„å­©å­ï¼šå³å­©å­ -> å³è¾¹çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­
                if head.next:
                    head.right.next = head.next.left

                head = head.next

            # ä¸‹ä¸€å±‚çš„å¤´ç»“ç‚¹ï¼ˆå› ä¸ºæ˜¯å®Œç¾äºŒå‰æ ‘ï¼Œå¿…ç„¶æ˜¯è¿™ä¸€å±‚æœ€å·¦èŠ‚ç‚¹çš„ leftï¼‰
            left_most = left_most.left

        return root
```

è¿™æ · 116 å’Œ 117 çš„å¤–å±‚ while éƒ½æ˜¯ç»Ÿä¸€æ¨¡å¼ï¼š

- åˆå§‹åŒ–ï¼š`level_head = root`
- æ¡ä»¶ï¼š`while level_head:`
- å¾ªç¯ä½“ï¼š
 - ç”¨ä¸€ä¸ªæŒ‡é’ˆéå†å½“å‰å±‚ï¼š`curr = level_head` / `head = level_head`
 - ä¸€è¾¹æ¨ªå‘èµ°ï¼Œä¸€è¾¹æŠŠä¸‹ä¸€å±‚ä¸²èµ·æ¥
 - äº§ç”Ÿ `next_level_head`
- å°¾éƒ¨ï¼š`level_head = next_level_head`

åŒºåˆ«åœ¨äºï¼š

- **116ï¼šå®Œç¾äºŒå‰æ ‘**
 - `next_level_head = level_head.left`
- **117ï¼šæ™®é€šäºŒå‰æ ‘**
 - `next_level_head = dummy.next`ï¼ˆé  dummy é“¾èµ·æ¥ï¼‰

---

## ä¸‰ã€å¯ä»¥èƒŒçš„ç»Ÿä¸€æ€ç»´æ¨¡æ¿ï¼ˆé¢è¯•å£è¿°ç”¨ï¼‰

ä½ å¯ä»¥æŠŠè¿™ä¸¤é¢˜ç»Ÿä¸€è®°æˆä¸€å¥è¯ï¼š

> æˆ‘çš„æ¨¡æ¿æ˜¯ï¼šç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å½“å‰å±‚çš„å¤´ç»“ç‚¹ `level_head`ï¼Œ`while level_head` è¯´æ˜è¿˜æœ‰è¿™ä¸€å±‚è¦å¤„ç†ï¼›åœ¨è¿™ä¸€å±‚é‡Œï¼Œæˆ‘æ²¿ç€ `next` æ¨ªå‘éå†ï¼Œä¸€è¾¹èµ°ä¸€è¾¹æŠŠä¸‹ä¸€å±‚çš„èŠ‚ç‚¹æŒ‰é¡ºåºä¸²æˆé“¾è¡¨ï¼Œæœ€åå¾—åˆ° `next_level_head`ï¼Œå†è®© `level_head = next_level_head` è¿›å…¥ä¸‹ä¸€å±‚ã€‚
> åŒºåˆ«åªæ˜¯ï¼šå®Œç¾äºŒå‰æ ‘æ—¶ `next_level_head` å°±æ˜¯ `level_head.left`ï¼Œæ™®é€šäºŒå‰æ ‘æ—¶éœ€è¦ç”¨ dummy + tail æŠŠä¸‹ä¸€å±‚æ‹¼å‡ºæ¥ã€‚

---
## ğŸ§‘â€ğŸ’» User

å˜é‡å‘½åä¸Šä¹Ÿèƒ½å†ç»Ÿä¸€ä¸‹å—

---
## ğŸ¤– Assistant

å¯ä»¥ï¼ŒæŠŠä¸¤é¢˜çš„å˜é‡å‘½åéƒ½æŠ½æˆ**åŒä¸€å¥—ã€ŒæŒ‰å±‚é“¾è¡¨æ¨¡æ¿ã€**æ¥è®°ï¼š

- `level_head`ï¼šå½“å‰å±‚é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼ˆæœ€å·¦èŠ‚ç‚¹ï¼‰
- `curr`ï¼šåœ¨å½“å‰å±‚é‡Œæ¨ªå‘èµ°çš„æŒ‡é’ˆï¼ˆæ²¿ç€ `next`ï¼‰
- `next_level_head`ï¼šä¸‹ä¸€å±‚é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼ˆæœ€å·¦èŠ‚ç‚¹ï¼‰
- ï¼ˆ117 å¤šä¸€ä¸ªï¼‰`next_level_tail`ï¼šä¸‹ä¸€å±‚é“¾è¡¨çš„å°¾æŒ‡é’ˆï¼Œç”¨æ¥å¾€åæ¥å­©å­
- ï¼ˆå¯é€‰ï¼‰`next_level_dummy`ï¼šä¸‹ä¸€å±‚é“¾è¡¨çš„è™šæ‹Ÿå¤´ç»“ç‚¹

è¿™æ ·ä¸¤é¢˜è„‘å­é‡Œå°±æ˜¯åŒä¸€ä¸ªç”»é¢ï¼Œåªæ˜¯ 116 ä¸éœ€è¦ dummy/tailã€‚

---

## ç»Ÿä¸€åçš„ 117 é¢˜å†™æ³•ï¼ˆæ™®é€šäºŒå‰æ ‘ï¼‰

```python
class Solution:
    def connect(self, root: 'Node') -> 'Node':
        """117é¢˜ï¼šä»»æ„äºŒå‰æ ‘ï¼Œä½¿ç”¨ O(1) é¢å¤–ç©ºé—´è¿æ¥ next æŒ‡é’ˆã€‚"""
        if not root:
            return None

        # level_head è¡¨ç¤ºå½“å‰å±‚é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼ˆæœ€å·¦è¾¹çš„èŠ‚ç‚¹ï¼‰
        level_head = root

        # ç»Ÿä¸€æ¨¡æ¿ï¼šwhile å½“å‰å±‚è¿˜æœ‰å¤´ç»“ç‚¹
        while level_head:
            # ç”¨è™šæ‹Ÿå¤´ç»“ç‚¹ + å°¾æŒ‡é’ˆæ‹¼å‡ºä¸‹ä¸€å±‚çš„é“¾è¡¨
            next_level_dummy = Node(0)
            next_level_tail = next_level_dummy

            # curr åœ¨å½“å‰å±‚æ²¿ç€ next æ¨ªå‘éå†
            curr = level_head
            while curr:
                if curr.left:
                    next_level_tail.next = curr.left
                    next_level_tail = next_level_tail.next
                if curr.right:
                    next_level_tail.next = curr.right
                    next_level_tail = next_level_tail.next

                curr = curr.next

            # ä¸‹ä¸€å±‚çš„å¤´ç»“ç‚¹
            level_head = next_level_dummy.next

        return root
```

---

## ç»Ÿä¸€åçš„ 116 é¢˜å†™æ³•ï¼ˆå®Œç¾äºŒå‰æ ‘ï¼‰

```python
class Solution:
    def connect(self, root: 'Optional[Node]') -> 'Optional[Node]':
        """116é¢˜ï¼šå®Œç¾äºŒå‰æ ‘ï¼Œä½¿ç”¨ O(1) é¢å¤–ç©ºé—´è¿æ¥ next æŒ‡é’ˆã€‚"""
        if not root:
            return None

        # level_head è¡¨ç¤ºå½“å‰å±‚é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼ˆæœ€å·¦è¾¹çš„èŠ‚ç‚¹ï¼‰
        level_head = root

        # ç»Ÿä¸€æ¨¡æ¿ï¼šwhile å½“å‰å±‚è¿˜æœ‰å¤´ç»“ç‚¹
        while level_head:
            # å¦‚æœå½“å‰å±‚å·²ç»æ˜¯å¶å­å±‚ï¼Œæ²¡æœ‰ä¸‹ä¸€å±‚å¯ä»¥è¿äº†
            if not level_head.left:
                break

            # curr åœ¨å½“å‰å±‚æ²¿ç€ next æ¨ªå‘éå†
            curr = level_head

            # ä¸‹ä¸€å±‚çš„å¤´ç»“ç‚¹ï¼ˆå®Œç¾äºŒå‰æ ‘ï¼šä¸€å®šæ˜¯æœ€å·¦èŠ‚ç‚¹çš„å·¦å­©å­ï¼‰
            next_level_head = level_head.left

            while curr:
                # è¿æ¥åŒä¸€çˆ¶èŠ‚ç‚¹çš„å·¦å³å­©å­
                curr.left.next = curr.right

                # è¿æ¥è·¨çˆ¶èŠ‚ç‚¹çš„å­©å­ï¼šå½“å‰å³å­©å­ -> å³ä¾§çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­
                if curr.next:
                    curr.right.next = curr.next.left

                curr = curr.next

            # è¿›å…¥ä¸‹ä¸€å±‚
            level_head = next_level_head

        return root
```

---

## å¯ä»¥èƒŒçš„ç»Ÿä¸€æ¨¡æ¿ï¼ˆå‘½å + æ€è·¯ï¼‰

ä½ å¯ä»¥ç›´æ¥æŠŠä¸¤é¢˜éƒ½è®°æˆè¿™ä¸ªç»Ÿä¸€å¥—è·¯ï¼š

1. `level_head`ï¼šå½“å‰å±‚çš„å¤´ç»“ç‚¹ï¼ˆæœ€å·¦èŠ‚ç‚¹ï¼‰
2. `while level_head:` è¯´æ˜è¿˜æœ‰è¿™ä¸€å±‚è¦å¤„ç†
3. `curr = level_head`ï¼Œåœ¨å½“å‰å±‚æ²¿ç€ `curr = curr.next` æ¨ªå‘èµ°
4. ä¸€è¾¹æ¨ªå‘èµ°ï¼Œä¸€è¾¹æŠŠä¸‹ä¸€å±‚æ‹¼æˆä¸€æ¡é“¾è¡¨ï¼š
 - 117ï¼šç”¨ `next_level_dummy` + `next_level_tail` åŠ¨æ€æ¥å­©å­
 - 116ï¼šå› ä¸ºæ˜¯å®Œç¾äºŒå‰æ ‘ï¼Œä¸‹ä¸€å±‚ç»“æ„è§„åˆ™ï¼Œç›´æ¥ç”¨ `curr.left` / `curr.right` è¿
5. ç®—å‡º `next_level_head`ï¼Œå† `level_head = next_level_head` è¿›å…¥ä¸‹ä¸€å±‚

ä¸¤é¢˜çš„å·®å¼‚åªåœ¨**â€œä¸‹ä¸€å±‚æ€ä¹ˆæ‹¼â€**ï¼Œè€Œå˜é‡åå’Œæ•´ä½“å¾ªç¯éª¨æ¶éƒ½æ˜¯ç»Ÿä¸€çš„ã€‚
