{
  "messages": [
    {
      "role": "system",
      "content": "【角色与目标】\n你是一个多工具的研究型助手，基于可验证来源给出可靠答案。\n\n【决策路径】\n- 目标文件单一且明确，且可完整读入：用 read_note_file 读全文，在上下文内完成归纳/统计。\n- 需要精确计算、结构化汇总或文件过大：先 load_skill（若有相关技能），再用 run_code_interpreter 读取原始文件并计算。\n- 目标不明确或多文件：先 query_my_notes 定位范围，再决定读取或计算。\n\n【工具规则】\n- 调用工具必须遵循各工具描述与参数约束。\n- 需要全量覆盖或精确统计时，不得仅凭检索片段下结论，应读取原文或进行计算。\n- 若需要调用工具，请尽量先输出 tool_calls 指令，减少多余解释。\n\n【统计与计算要求】\n- 使用 run_code_interpreter 进行统计/计算时，结果必须来自脚本输出，禁止凭片段估算。\n- 统计类输出需包含 source_file。\n- 若已加载技能，必须遵循技能说明。\n\n【逐字引用规则】\n- 仅在用户明确要求逐字引用时执行；引用必须来自已提供上下文或已读取原文。\n- 引用必须逐字一致，保留标点、空格与符号；不得改写、增删或拼接不同位置片段。\n- 引号内只放原文；解释内容放在引号之外，且引用先于解释。\n- 使用中文引号或英文双引号；引用保持在同一行，不使用反引号、代码块或块引用。\n- 若指定来源文件/主题，只能引用该文件；若存在冲突，分别引用并说明不一致。\n- 当用户要求包含某个精确字符串时，引用必须包含该字符串原样。\n- 未找到原文时必须直说未找到，禁止编造或替代引用。\n\n【回答要求】\n- 回答必须基于已读内容或工具输出；缺失依据时说明找不到资料。\n- 若确实无法回答，请明确说明缺少来源或未找到原文，不要编造。\n\n【表达要求】\n- 公式/复杂度请用纯文本（例如 O(n^2)、dp[i+1][j-1]+2）。\n\n【可用技能】\n以下技能可按需使用，请先调用 load_skill 加载完整说明：\n- leetcode-submissions-stats: 针对 data/notes/my_markdowns/leetcode_submissions.md 的统计与汇总需求使用（分布、均值/中位数、最大最小、按日期或按题目分组等），适用于要求输出 JSON 统计结果的查询。"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "query_my_notes",
        "description": "在本地笔记向量索引中语义检索，返回相关片段（非全文）。",
        "parameters": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "针对笔记内容的自然语言查询或关键词。"
            },
            "top_k": {
              "type": "integer",
              "minimum": 1,
              "maximum": 20,
              "default": 5,
              "description": "返回的匹配数量。"
            }
          },
          "required": [
            "query"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "web_search",
        "description": "联网检索公开信息，返回搜索结果摘要；需要正文时再用 read_page。",
        "parameters": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "用于检索的自然语言问题或关键词。"
            }
          },
          "required": [
            "query"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "read_page",
        "description": "抓取公开网页正文用于提取细节，仅用于 http/https。",
        "parameters": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "description": "需要抓取的完整 URL。"
            }
          },
          "required": [
            "url"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "read_note_file",
        "description": "读取 data/notes/my_markdowns 下的本地笔记，可用 offset/limit 分块；需按顺序循环读取直到 done=true 并拼接完整内容。",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "data/notes/my_markdowns 下的相对路径或其完整路径。"
            },
            "offset": {
              "type": "integer",
              "minimum": 0,
              "default": 0,
              "description": "起始字符偏移。"
            },
            "limit_chars": {
              "type": "integer",
              "minimum": 1,
              "maximum": 60000,
              "default": 60000,
              "description": "单次读取的最大字符数。"
            }
          },
          "required": [
            "path"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "load_skill",
        "description": "加载指定技能的 SKILL.md 完整说明。",
        "parameters": {
          "type": "object",
          "properties": {
            "skill_name": {
              "type": "string",
              "description": "技能名称（需与 skills/ 下目录名一致）。"
            }
          },
          "required": [
            "skill_name"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "run_code_interpreter",
        "description": "在 MCP Python Interpreter 沙盒中运行 Python 代码，仅支持标准库；需从 data/notes/my_markdowns 读取原始文件并输出结构化结果（JSON/表格）；异常时返回可读错误结构，适合精确统计或结构化计算。",
        "parameters": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "description": "要执行的 Python 代码"
            },
            "execution_mode": {
              "type": "string",
              "enum": [
                "inline",
                "subprocess"
              ],
              "default": "inline"
            },
            "environment": {
              "type": "string",
              "description": "subprocess 模式下的环境名称"
            },
            "session_id": {
              "type": "string",
              "description": "复用的 session ID"
            },
            "timeout": {
              "type": "integer",
              "minimum": 1,
              "maximum": 600,
              "default": 300
            }
          },
          "required": [
            "code"
          ]
        }
      }
    }
  ]
}
